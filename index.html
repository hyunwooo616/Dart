<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>프로 에임 트레이너 - UI 커스텀</title>
    <style>
        body { margin: 0; overflow: hidden; background: #121212; color: white; font-family: 'Arial Black', sans-serif; }
        
        /* 로비 UI */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0, 0, 0, 0.9); z-index: 1000;
        }
        .container { text-align: center; background: #1e1e1e; padding: 40px; border-radius: 20px; border: 2px solid #00ff00; width: 450px; }
        .mode-container { display: flex; flex-direction: column; gap: 15px; margin: 30px 0; }
        button {
            padding: 15px; cursor: pointer; background: #333; border: 1px solid #00ff00; border-radius: 10px;
            color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center;
        }
        button:hover { background: #00ff00; color: black; }

        /* 인게임 UI */
        #ingame-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 500; display: none;
        }
        
        /* [수정] 콤보 & 배수 위치를 좌측 상단으로 */
        .status-left-top {
            position: absolute; top: 20px; left: 20px;
            display: flex; flex-direction: column; align-items: flex-start;
        }
        #combo-display {
            font-size: 50px; font-weight: 900; line-height: 1;
            text-shadow: 3px 3px 0px #000;
            transition: all 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #multiplier-display {
            font-size: 24px; color: #f1c40f; font-weight: bold;
            text-shadow: 2px 2px 0px #000; margin-top: 5px;
        }

        .top-bar { position: absolute; top: 20px; width: 100%; text-align: center; }
        
        /* 형광색 커서 */
        #custom-cursor {
            position: absolute; width: 12px; height: 12px; background: #00ff00;
            border-radius: 50%; pointer-events: none; z-index: 999; display: none;
            transform: translate(-50%, -50%); box-shadow: 0 0 10px #00ff00;
        }

        /* 화면 흔들림 애니메이션 */
        @keyframes shake {
            0% { transform: translate(1px, 1px); }
            20% { transform: translate(-3px, 0px); }
            40% { transform: translate(3px, 2px); }
            60% { transform: translate(-3px, 1px); }
            80% { transform: translate(3px, 1px); }
            100% { transform: translate(1px, -2px); }
        }
        .shake { animation: shake 0.2s; }

        canvas { display: block; cursor: none; position: relative; z-index: 1; }
    </style>
</head>
<body>

    <div id="custom-cursor"></div>

    <div id="overlay">
        <div class="container">
            <h1>AIM TRAINER</h1>
            <div class="mode-container">
                <button onclick="startGame('small')">Small & Fast <span class="best-label">BEST: <span id="hs-small">0</span></span></button>
                <button onclick="startGame('big')">Big & Easy <span class="best-label">BEST: <span id="hs-big">0</span></span></button>
            </div>
            <div>
                <label>마우스 감도: <span id="sens-val" style="color:#00ff00">1.0</span></label><br>
                <input type="range" id="sens-range" min="0.1" max="5.0" step="0.1" value="1.0">
            </div>
        </div>
    </div>

    <div id="ingame-ui">
        <div class="top-bar">
            <div style="font-size: 40px; color: #ff4d4d;" id="timer">20</div>
            <div style="font-size: 24px; color: #00ff00;">SCORE: <span id="score-val">0</span></div>
        </div>
        
        <div class="status-left-top">
            <div id="combo-display">0 COMBO</div>
            <div id="multiplier-display">x1.0 Bonus</div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        /**
         * [ 게임 핵심 설정 변수 ]
         */
        const GAME_TIME = 20;
        const BASE_SCORE = 100;
        const MISS_PENALTY = 50;
        const MODES = {
            small: { radius: 10, count: 10 },
            big: { radius: 30, count: 8 }
        };
        const TARGET_COLORS = ['#ff4d4d', '#ffffff', '#ff4d4d', '#f1c40f'];
        const COMBO_COLORS = ["#ffffff", "#ffeb3b", "#ff9800", "#ff3e3e"];

        /**
         * [ 시스템 변수 ]
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const cursor = document.getElementById('custom-cursor');
        const comboEl = document.getElementById('combo-display');
        const multEl = document.getElementById('multiplier-display');
        const scoreEl = document.getElementById('score-val');
        const sensRange = document.getElementById('sens-range');

        let score = 0, combo = 0, timeLeft = GAME_TIME;
        let targets = [], particles = [], gameActive = false, currentMode = '';
        let vX = window.innerWidth / 2, vY = window.innerHeight / 2, sensitivity = 1.0;
        let highScores = { small: 0, big: 0 };

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        sensRange.oninput = (e) => {
            sensitivity = parseFloat(e.target.value);
            document.getElementById('sens-val').innerText = sensitivity.toFixed(1);
        };

        window.onmousemove = (e) => {
            if (!gameActive) return;
            vX = Math.max(0, Math.min(canvas.width, vX + e.movementX * sensitivity));
            vY = Math.max(0, Math.min(canvas.height, vY + e.movementY * sensitivity));
            cursor.style.left = vX + 'px';
            cursor.style.top = vY + 'px';
        };

        function createParticles(x, y, color) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x, y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1.0,
                    color
                });
            }
        }

        function shakeScreen() {
            canvas.classList.remove('shake');
            void canvas.offsetWidth;
            canvas.classList.add('shake');
            setTimeout(() => canvas.classList.remove('shake'), 200);
        }

        function updateComboUI(isHit) {
            comboEl.innerText = `${combo} COMBO`;
            
            // 배수 계산 로직 (5콤보당 0.5씩 증가, 최대 5배)
            const multiplier = Math.min(5, 1 + (Math.floor(combo / 5) * 0.5));
            multEl.innerText = `x${multiplier.toFixed(1)} Bonus`;
            
            let colorIndex = Math.min(Math.floor(combo / 5), COMBO_COLORS.length - 1);
            comboEl.style.color = COMBO_COLORS[colorIndex];

            if (isHit) {
                comboEl.style.transform = "scale(1.1)";
                setTimeout(() => { comboEl.style.transform = "scale(1)"; }, 100);
            }
        }

        window.onmousedown = () => {
            if (!gameActive) return;
            let hitIdx = -1;
            for (let i = targets.length - 1; i >= 0; i--) {
                const t = targets[i];
                if (Math.sqrt((vX - t.x)**2 + (vY - t.y)**2) <= t.r) { hitIdx = i; break; }
            }

            if (hitIdx !== -1) {
                combo++;
                const multiplier = Math.min(5, 1 + (Math.floor(combo / 5) * 0.5));
                score += Math.floor(BASE_SCORE * multiplier);
                createParticles(targets[hitIdx].x, targets[hitIdx].y, '#00ff00');
                targets.splice(hitIdx, 1);
                targets.push(getPos(MODES[currentMode].radius));
            } else {
                combo = 0;
                score = Math.max(0, score - MISS_PENALTY);
                shakeScreen();
            }
            scoreEl.innerText = score;
            updateComboUI(hitIdx !== -1);
        };

        function getPos(r) {
            let x, y, overlap, tries = 0;
            do {
                overlap = false;
                x = Math.random() * (canvas.width - 200) + 100;
                y = Math.random() * (canvas.height - 200) + 100;
                for (let t of targets) {
                    if (Math.sqrt((x - t.x)**2 + (y - t.y)**2) < (r + t.r + 20)) { overlap = true; break; }
                }
                tries++;
            } while (overlap && tries < 100);
            return { x, y, r };
        }

        function startGame(mode) {
            currentMode = mode;
            score = 0; combo = 0; timeLeft = GAME_TIME; targets = []; particles = [];
            vX = canvas.width / 2; vY = canvas.height / 2;
            scoreEl.innerText = "0";
            updateComboUI(false);
            for(let i=0; i < MODES[mode].count; i++) targets.push(getPos(MODES[mode].radius));
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('ingame-ui').style.display = 'block';
            cursor.style.display = 'block';
            canvas.requestPointerLock();
            gameActive = true;
            render();
            const timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = timeLeft;
                if (timeLeft <= 0) { clearInterval(timerInterval); endGame(); }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            document.exitPointerLock();
            if (score > highScores[currentMode]) {
                highScores[currentMode] = score;
                document.getElementById(`hs-${currentMode}`).innerText = score;
            }
            document.getElementById('overlay').style.display = 'flex';
            document.getElementById('ingame-ui').style.display = 'none';
            cursor.style.display = 'none';
        }

        function render() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                ctx.globalAlpha = p.life; ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 4, 4);
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                if (p.life <= 0) particles.splice(i, 1);
            }
            ctx.globalAlpha = 1.0;
            targets.forEach(t => {
                const steps = [1, 0.7, 0.4, 0.15];
                steps.forEach((s, i) => {
                    ctx.beginPath(); ctx.arc(t.x, t.y, t.r * s, 0, Math.PI * 2);
                    ctx.fillStyle = TARGET_COLORS[i]; ctx.fill(); ctx.stroke();
                });
            });
            requestAnimationFrame(render);
        }

        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    </script>
</body>
</html>